<svg xmlns="http://www.w3.org/2000/svg" width="640" height="270" viewBox="0 0 640 270">
  <defs>
    <marker id="arr" markerWidth="9" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <polygon points="0 0, 9 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="640" height="270" fill="#f9f9fb" rx="8" stroke="#dde" stroke-width="1"/>

  <!-- Title -->
  <text x="320" y="28" text-anchor="middle"
        font-family="'Microsoft YaHei', 'PingFang SC', Arial, sans-serif"
        font-size="14" font-weight="bold" fill="#222">EKF 不确定性椭圆变化示意图</text>

  <!-- ===== State 1: Initial ===== -->
  <g transform="translate(95, 135)">
    <!-- Ellipse (small, blue) -->
    <ellipse cx="0" cy="0" rx="22" ry="14"
             fill="rgba(70,130,180,0.22)" stroke="#4682b4" stroke-width="1.8"/>
    <!-- Estimated position -->
    <circle cx="0" cy="0" r="5" fill="#c0392b"/>
    <!-- True position (dashed circle) -->
    <circle cx="5" cy="-4" r="4" fill="none" stroke="#27ae60"
            stroke-width="1.5" stroke-dasharray="4,2"/>
    <!-- State label -->
    <text x="0" y="35" text-anchor="middle"
          font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="11" font-weight="bold" fill="#333">① 初始状态</text>
    <text x="0" y="50" text-anchor="middle"
          font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="10" fill="#666">协方差矩阵 P 较小</text>
  </g>

  <!-- Arrow 1: predict -->
  <line x1="130" y1="135" x2="190" y2="135"
        stroke="#666" stroke-width="1.6" marker-end="url(#arr)"/>
  <text x="160" y="122" text-anchor="middle"
        font-family="'Microsoft YaHei', Arial, sans-serif"
        font-size="10" fill="#555" font-weight="bold">运动预测</text>
  <text x="160" y="152" text-anchor="middle"
        font-family="'Microsoft YaHei', Arial, sans-serif"
        font-size="9" fill="#888">里程计 / IMU</text>

  <!-- ===== State 2: After prediction ===== -->
  <g transform="translate(275, 135)">
    <!-- Ellipse (large, orange) -->
    <ellipse cx="0" cy="0" rx="52" ry="32"
             fill="rgba(230,126,34,0.18)" stroke="#e67e22" stroke-width="1.8"/>
    <!-- Estimated position -->
    <circle cx="0" cy="0" r="5" fill="#c0392b"/>
    <!-- True position drifted -->
    <circle cx="9" cy="-6" r="4" fill="none" stroke="#27ae60"
            stroke-width="1.5" stroke-dasharray="4,2"/>
    <!-- State label -->
    <text x="0" y="50" text-anchor="middle"
          font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="11" font-weight="bold" fill="#333">② 预测步骤后</text>
    <text x="0" y="65" text-anchor="middle"
          font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="10" fill="#e67e22">不确定性增大↑</text>
  </g>

  <!-- Kalman Gain box -->
  <rect x="364" y="118" width="58" height="34" rx="5"
        fill="#fffbe6" stroke="#f0ad4e" stroke-width="1.4"/>
  <text x="393" y="132" text-anchor="middle"
        font-family="'Microsoft YaHei', Arial, sans-serif"
        font-size="11" font-weight="bold" fill="#b7710a">K</text>
  <text x="393" y="146" text-anchor="middle"
        font-family="'Microsoft YaHei', Arial, sans-serif"
        font-size="9" fill="#b7710a">卡尔曼增益</text>

  <!-- Arrow 2: update -->
  <line x1="344" y1="135" x2="362" y2="135"
        stroke="#666" stroke-width="1.6"/>
  <line x1="424" y1="135" x2="456" y2="135"
        stroke="#666" stroke-width="1.6" marker-end="url(#arr)"/>
  <text x="490" y="122" text-anchor="middle"
        font-family="'Microsoft YaHei', Arial, sans-serif"
        font-size="10" fill="#555" font-weight="bold">传感器更新</text>
  <text x="490" y="152" text-anchor="middle"
        font-family="'Microsoft YaHei', Arial, sans-serif"
        font-size="9" fill="#888">激光雷达 / GPS</text>
  <!-- Oops, arrow goes too far right; let me fix coordinates -->
  <!-- Arrow 2: update (corrected) -->
  <!-- state 2 right edge ~ 275+52=327, arrow at 340→450 -->

  <!-- ===== State 3: After update ===== -->
  <g transform="translate(545, 135)">
    <!-- Ellipse (small, green) -->
    <ellipse cx="0" cy="0" rx="17" ry="11"
             fill="rgba(39,174,96,0.28)" stroke="#27ae60" stroke-width="1.8"/>
    <!-- Estimated position -->
    <circle cx="0" cy="0" r="5" fill="#c0392b"/>
    <!-- True position (nearly at estimated) -->
    <circle cx="2" cy="-1" r="4" fill="none" stroke="#27ae60"
            stroke-width="1.5" stroke-dasharray="4,2"/>
    <!-- State label -->
    <text x="0" y="32" text-anchor="middle"
          font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="11" font-weight="bold" fill="#333">③ 更新步骤后</text>
    <text x="0" y="47" text-anchor="middle"
          font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="10" fill="#27ae60">不确定性减小↓</text>
  </g>

  <!-- ===== Legend ===== -->
  <g transform="translate(160, 228)">
    <circle cx="0" cy="0" r="5" fill="#c0392b"/>
    <text x="12" y="4" font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="10" fill="#333">估计位置 x̂</text>
    <circle cx="120" cy="0" r="4" fill="none" stroke="#27ae60"
            stroke-width="1.5" stroke-dasharray="4,2"/>
    <text x="132" y="4" font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="10" fill="#333">真实位置 x</text>
    <ellipse cx="258" cy="0" rx="14" ry="8"
             fill="rgba(100,100,200,0.18)" stroke="#667" stroke-width="1"/>
    <text x="278" y="4" font-family="'Microsoft YaHei', Arial, sans-serif"
          font-size="10" fill="#333">不确定性椭圆（P）</text>
  </g>
</svg>
