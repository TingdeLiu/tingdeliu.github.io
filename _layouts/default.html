<!DOCTYPE html>
<html>
  {% include head.html %}
  <body class="{% if page.layout == 'post' %}no-sidebar{% endif %}">
    <!-- 只在非文章页面显示导航侧边栏 -->
    {% unless page.layout == 'post' %}
      {% include nav.html %}
    {% endunless %}

    <!-- 如果当前页面的toc为true，就添加目录 -->
    {% if page.toc==true %}
      <aside class="toc">
        {% include toc.html html=content h_min=1 h_max=2 %}
      </aside>
    {% endif %}

    <div id="main" role="main" class="wrapper-content">
      <div class="container">
        {{ content }}
      </div>
    </div>

    <!-- Google Analytics -->
    {% include analytics.html %}
  </body>

  <!-- 如果当前页面的toc为true，就添加目录 -->
  {% if page.toc==true %}
  <script>
    document.getElementById("main").classList.add("withtoc");
  </script>
  {% endif %}

  <div class="wrapper-footer-mobile">
    <footer class="footer">
      {% include footer.html %}
    </footer>
  </div>

  <!-- 标签自动着色：对标签名哈希映射到调色板，同名标签颜色全站一致 -->
  <script>
    (function () {
      var palette = [
        { bg: '#d0ebff', text: '#1864ab', hover: '#a5d8ff' }, // 蓝
        { bg: '#d3f9d8', text: '#2b8a3e', hover: '#b2f2bb' }, // 绿
        { bg: '#e5dbff', text: '#5f3dc4', hover: '#d0bfff' }, // 紫
        { bg: '#ffe8cc', text: '#d9480f', hover: '#ffd8a8' }, // 橙
        { bg: '#fff3bf', text: '#e67700', hover: '#ffec99' }, // 黄
        { bg: '#ffd6e0', text: '#c2255c', hover: '#ffa8c5' }, // 粉
        { bg: '#c5f6fa', text: '#0c8599', hover: '#99e9f2' }, // 青
      ];

      function hash(str) {
        var h = 0;
        for (var i = 0; i < str.length; i++) {
          h = str.charCodeAt(i) + ((h << 5) - h);
        }
        return Math.abs(h);
      }

      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.tag li > a').forEach(function (el) {
          var tag = el.textContent.trim();
          var c = palette[hash(tag) % palette.length];
          el.style.backgroundColor = c.bg;
          el.style.color = c.text;
          el.addEventListener('mouseenter', function () { el.style.backgroundColor = c.hover; });
          el.addEventListener('mouseleave', function () { el.style.backgroundColor = c.bg; });
        });
      });
    })();
  </script>

  <!-- Mermaid 图表支持 -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    // 初始化 Mermaid
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      flowchart: {
        htmlLabels: true,
        useMaxWidth: true
      }
    });

    // 转换 kramdown 渲染的 Mermaid 代码块
    document.addEventListener('DOMContentLoaded', function() {
      // 查找所有 language-mermaid 代码块
      const mermaidBlocks = document.querySelectorAll('code.language-mermaid');

      mermaidBlocks.forEach(function(block) {
        // 创建新的 div 元素
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = block.textContent;

        // 替换原来的 pre>code 结构
        const pre = block.parentElement;
        pre.parentElement.replaceChild(div, pre);
      });

      // 渲染所有 Mermaid 图表
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    });
  </script>

</html>
