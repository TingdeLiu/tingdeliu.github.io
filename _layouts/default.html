<!DOCTYPE html>
<html>
  {% include head.html %}
  <body class="{% if page.layout == 'post' %}no-sidebar{% endif %}">
    <!-- 只在非文章页面显示导航侧边栏 -->
    {% unless page.layout == 'post' %}
      {% include nav.html %}
    {% endunless %}

    <!-- 如果当前页面的toc为true，就添加目录 -->
    {% if page.toc==true %}
      <aside class="toc">
        {% include toc.html html=content h_min=1 h_max=2 %}
      </aside>
    {% endif %}

    <div id="main" role="main" class="wrapper-content">
      <div class="container">
        {{ content }}
      </div>
    </div>

    <!-- Google Analytics -->
    {% include analytics.html %}
  </body>

  <!-- 如果当前页面的toc为true，就添加目录 -->
  {% if page.toc==true %}
  <script>
    document.getElementById("main").classList.add("withtoc");
  </script>
  {% endif %}

  <div class="wrapper-footer-mobile">
    <footer class="footer">
      {% include footer.html %}
    </footer>
  </div>

  <!-- Mermaid 图表支持 -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    // 初始化 Mermaid
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      flowchart: {
        htmlLabels: true,
        useMaxWidth: true
      }
    });

    // 转换 kramdown 渲染的 Mermaid 代码块
    document.addEventListener('DOMContentLoaded', function() {
      // 查找所有 language-mermaid 代码块
      const mermaidBlocks = document.querySelectorAll('code.language-mermaid');

      mermaidBlocks.forEach(function(block) {
        // 创建新的 div 元素
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = block.textContent;

        // 替换原来的 pre>code 结构
        const pre = block.parentElement;
        pre.parentElement.replaceChild(div, pre);
      });

      // 渲染所有 Mermaid 图表
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    });
  </script>

</html>
